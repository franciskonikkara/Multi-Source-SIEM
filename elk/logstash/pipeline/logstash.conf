# This script transforms raw logs into a format the SIEM can understand (normalization).
# Multi-Source Logstash Pipeline
input {
  # Source 1: EDR & CrowdStrike Simulation
  file {
    path => "/usr/share/logstash/edr-simulation/logs/*.json"
    codec => "json"
    start_position => "beginning"
    sincedb_path => "/dev/null"
    type => "edr_telemetry"
    add_field => { "siem_platform" => "Elastic_SIEM" }
  }

  # Source 2: AWS CloudTrail Simulation
  file {
    path => "/usr/share/logstash/cloud-simulation/logs/*.json"
    codec => "json"
    start_position => "beginning"
    sincedb_path => "/dev/null"
    type => "aws_cloud"
    add_field => { "siem_platform" => "Multi_Cloud_Monitor" }
  }
}

filter {
  # Normalize severity for EDR
  if [type] == "edr_telemetry" and [severity] == "critical" {
    mutate { add_tag => ["ALERT_IMMEDIATE", "EDR_THREAT"] }
  }

  # Identify Impossible Travel for AWS
  if [type] == "aws_cloud" and [status] == "Success" {
    mutate { add_tag => ["CLOUD_ACCESS", "GEO_CHECK"] }
  }
}

output {
  # Route EDR data to its own index
  if [type] == "edr_telemetry" {
    elasticsearch {
      hosts => ["http://elasticsearch:9200"]
      index => "siem-edr-logs-%{+YYYY.MM.dd}"
    }
  }

  # Route AWS data to its own index
  if [type] == "aws_cloud" {
    elasticsearch {
      hosts => ["http://elasticsearch:9200"]
      index => "siem-cloud-aws-%{+YYYY.MM.dd}"
    }
  }

  # Debugging output in console
  stdout { codec => rubydebug }
}
# This Logstash configuration file processes raw logs from the EDR simulation, normalizes them into a SIEM-compatible format, tags critical events for immediate alerts, and outputs the processed data to an Elasticsearch index for further analysis and visualization in the SIEM dashboard.
